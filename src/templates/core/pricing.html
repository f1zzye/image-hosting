{% extends 'partials/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/core/pricing.css' %}">
{% endblock %}

{% block content %}
<main>
    <div class="container">
        <div class="hero-section">
            <h1>Choose Your Plan</h1>
            <p>Select the perfect plan for your photo hosting needs. All plans include secure storage, fast delivery, and 24/7 support.</p>
            <div style="margin-top: 36px;">
                <h3>Current Plan: {{ current_subscription.plan.title }}</h3>
            </div>
        </div>

        <div class="pricing-grid">
            <!-- Basic Plan -->
            {% if basic_plan %}
            <div class="pricing-card">
                <h3 class="plan-name">{{ basic_plan.title }}</h3>
                <div class="plan-price">
                    {% if basic_plan.price == 0 %}
                        Free
                    {% else %}
                        ${{ basic_plan.price }}<span>/month</span>
                    {% endif %}
                </div>
                <p class="plan-description">{{ basic_plan.description }}</p>

                <ul class="features-list">
                    <li>
                        {% if basic_plan.has_thumbnail_200px %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        200px Thumbnails
                    </li>
                    <li>
                        {% if basic_plan.has_thumbnail_400px %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        400px Thumbnails
                    </li>
                    <li>
                        {% if basic_plan.has_original_photo %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        Original Photos
                    </li>
                    <li>
                        {% if basic_plan.has_binary_link %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        Binary Download Links
                    </li>
                </ul>

                {% if current_subscription.plan.title == 'Basic' %}
                    <button class="choose-plan-btn disabled" disabled>Current Plan</button>
                {% else %}
                    <!-- Нельзя downgrade до окончания подписки -->
                    <div class="downgrade-info">
                        <button class="choose-plan-btn no-downgrade" disabled>
                            Your current plan is higher
                        </button>
                        <p class="downgrade-note">
                            <small>
                                You cannot downgrade during active subscription.<br>
                                This plan will be available after {{ current_subscription.expires_at|date:"M j, Y" }}
                            </small>
                        </p>
                    </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Premium Plan -->
            {% if premium_plan %}
            <div class="pricing-card featured">
                <h3 class="plan-name">{{ premium_plan.title }}</h3>
                <div class="plan-price">
                    ${{ premium_plan.price }}<span>/month</span>
                </div>
                <p class="plan-description">{{ premium_plan.description }}</p>

                <ul class="features-list">
                    <li>
                        {% if premium_plan.has_thumbnail_200px %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        200px Thumbnails
                    </li>
                    <li>
                        {% if premium_plan.has_thumbnail_400px %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        400px Thumbnails
                    </li>
                    <li>
                        {% if premium_plan.has_original_photo %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        Original Photos
                    </li>
                    <li>
                        {% if premium_plan.has_binary_link %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        Binary Download Links
                    </li>
                </ul>

                {% if current_subscription.plan.title == 'Premium' %}
                    <button class="choose-plan-btn disabled" disabled>Current Plan</button>
                {% elif current_subscription.plan.title == 'Enterprise' %}
                    <!-- Нельзя downgrade с Enterprise на Premium -->
                    <div class="downgrade-info">
                        <button class="choose-plan-btn no-downgrade" disabled>
                            Your current plan is higher
                        </button>
                        <p class="downgrade-note">
                            <small>
                                You cannot downgrade during active subscription.<br>
                                This plan will be available after {{ current_subscription.expires_at|date:"M j, Y" }}
                            </small>
                        </p>
                    </div>
                {% else %}
                    <!-- Если пользователь на Basic - можно upgrade -->
                    <div id="paypal-button-container-premium"></div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Enterprise Plan -->
            {% if enterprise_plan %}
            <div class="pricing-card">
                <h3 class="plan-name">{{ enterprise_plan.title }}</h3>
                <div class="plan-price">
                    ${{ enterprise_plan.price }}<span>/month</span>
                </div>
                <p class="plan-description">{{ enterprise_plan.description }}</p>

                <ul class="features-list">
                    <li>
                        {% if enterprise_plan.has_thumbnail_200px %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        200px Thumbnails
                    </li>
                    <li>
                        {% if enterprise_plan.has_thumbnail_400px %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        400px Thumbnails
                    </li>
                    <li>
                        {% if enterprise_plan.has_original_photo %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        Original Photos
                    </li>
                    <li>
                        {% if enterprise_plan.has_binary_link %}
                            <svg viewBox="0 0 24 24">
                                <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
                            </svg>
                        {% else %}
                            <svg viewBox="0 0 24 24" class="cross-icon">
                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                            </svg>
                        {% endif %}
                        Binary Download Links
                    </li>
                </ul>

                {% if current_subscription.plan.title == 'Enterprise' %}
                    <button class="choose-plan-btn disabled" disabled>Current Plan</button>
                {% else %}
                    <div id="paypal-button-container-enterprise"></div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</main>

<script src="https://www.paypal.com/sdk/js?client-id=AWlQofV_kJ2k_IPUR7zNcH2Vol3q2eTNHlzSvAmC4bEB2EJ-VcYi0BmzbFb1qm8cZbia2hlvhq1YB6aj&vault=true&intent=subscription" data-sdk-integration-source="button-factory"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const premiumContainer = document.getElementById('paypal-button-container-premium');
        if (premiumContainer) {
            paypal.Buttons({
                style: {
                    shape: 'pill',
                    color: 'blue',
                    layout: 'horizontal',
                    label: 'subscribe'
                },
                createSubscription: function (data, actions) {
                    return actions.subscription.create({
                        plan_id: '{{ premium_plan_id }}'
                    });
                },
                onApprove: function (data, actions) {
                    const current_url = '/billing/update-tariff/' + data.subscriptionID + "/Premium"
                    window.location.href = current_url;
                }
            }).render('#paypal-button-container-premium');
        }

        const enterpriseContainer = document.getElementById('paypal-button-container-enterprise');
        if (enterpriseContainer) {
            paypal.Buttons({
                style: {
                    shape: 'pill',
                    color: 'silver',
                    layout: 'horizontal',
                    label: 'subscribe'
                },
                createSubscription: function (data, actions) {
                    return actions.subscription.create({
                        plan_id: '{{ enterprise_plan_id }}'
                    });
                },
                onApprove: function (data, actions) {
                    const current_url = '/billing/update-tariff/' + data.subscriptionID + "/Enterprise"
                    window.location.href = current_url;
                }
            }).render('#paypal-button-container-enterprise');
        }
    });
</script>
{% endblock %}